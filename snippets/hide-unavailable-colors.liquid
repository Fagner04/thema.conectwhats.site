{%- comment -%}
  Script para ocultar cores que não têm nenhum tamanho disponível
  Funciona com produtos que têm opções de Cor e Tamanho
{%- endcomment -%}

<script>
(function() {
  'use strict';
  
  function hideUnavailableColors() {
    // Verifica se o produto tem variantes
    if (!window.theme || !window.theme.product || !window.theme.product.variants) {
      return;
    }
    
    var variants = window.theme.product.variants;
    var colorOption = null;
    var sizeOption = null;
    
    // Identifica qual opção é cor e qual é tamanho
    if (window.theme.product.options) {
      window.theme.product.options.forEach(function(option, index) {
        var optionName = option.toLowerCase();
        if (optionName.includes('cor') || optionName.includes('color') || optionName.includes('colour')) {
          colorOption = 'option' + (index + 1);
        }
        if (optionName.includes('tamanho') || optionName.includes('size') || optionName.includes('talla')) {
          sizeOption = 'option' + (index + 1);
        }
      });
    }
    
    // Se não encontrou cor e tamanho, não faz nada
    if (!colorOption || !sizeOption) {
      return;
    }
    
    // Agrupa variantes por cor
    var colorAvailability = {};
    
    variants.forEach(function(variant) {
      var color = variant[colorOption];
      
      if (!colorAvailability[color]) {
        colorAvailability[color] = {
          hasStock: false,
          sizes: []
        };
      }
      
      // Verifica se esta variante tem estoque
      if (variant.available) {
        colorAvailability[color].hasStock = true;
      }
      
      colorAvailability[color].sizes.push({
        size: variant[sizeOption],
        available: variant.available
      });
    });
    
    // Oculta cores sem estoque
    Object.keys(colorAvailability).forEach(function(color) {
      if (!colorAvailability[color].hasStock) {
        // Encontra o input radio da cor
        var colorInputs = document.querySelectorAll('.color-swatch__radio');
        
        colorInputs.forEach(function(input) {
          if (input.value.toLowerCase() === color.toLowerCase()) {
            // Oculta o container da cor
            var colorSwatch = input.closest('.color-swatch');
            if (colorSwatch) {
              colorSwatch.style.display = 'none';
              
              // Adiciona atributo para facilitar debug
              colorSwatch.setAttribute('data-hidden-no-stock', 'true');
            }
          }
        });
      }
    });
    
    // Log para debug (pode remover em produção)
    console.log('Cores disponíveis:', colorAvailability);
  }
  
  // Executa quando a página carregar
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', hideUnavailableColors);
  } else {
    hideUnavailableColors();
  }
  
  // Re-executa se houver mudanças no produto (para temas dinâmicos)
  if (window.theme && window.theme.product) {
    setTimeout(hideUnavailableColors, 500);
    setTimeout(hideUnavailableColors, 1000);
  }
  
})();
</script>

<style>
/* Oculta cores sem estoque */
.color-swatch[data-hidden-no-stock="true"] {
  display: none !important;
}
</style>
