{%- comment -%}
  Script para ocultar cores que n√£o t√™m nenhum tamanho dispon√≠vel
  Funciona com produtos que t√™m op√ß√µes de Cor e Tamanho
{%- endcomment -%}

<script>
(function() {
  'use strict';
  
  function hideUnavailableColors() {
    console.log('üé® Iniciando verifica√ß√£o de cores sem estoque...');
    
    // Verifica se o produto tem variantes
    if (!window.theme || !window.theme.product || !window.theme.product.variants) {
      console.log('‚ùå Dados do produto n√£o encontrados');
      return;
    }
    
    var variants = window.theme.product.variants;
    var options = window.theme.product.options;
    
    console.log('üì¶ Produto:', window.theme.product.id);
    console.log('üìã Op√ß√µes:', options);
    console.log('üî¢ Total de variantes:', variants.length);
    
    var colorOption = null;
    var sizeOption = null;
    var colorIndex = -1;
    
    // Identifica qual op√ß√£o √© cor e qual √© tamanho
    if (options) {
      options.forEach(function(option, index) {
        var optionName = option.toLowerCase();
        console.log('Op√ß√£o ' + (index + 1) + ':', option);
        
        if (optionName.includes('cor') || optionName.includes('color') || optionName.includes('colour')) {
          colorOption = 'option' + (index + 1);
          colorIndex = index;
          console.log('‚úÖ Cor encontrada na op√ß√£o ' + (index + 1));
        }
        if (optionName.includes('tamanho') || optionName.includes('size') || optionName.includes('talla')) {
          sizeOption = 'option' + (index + 1);
          console.log('‚úÖ Tamanho encontrado na op√ß√£o ' + (index + 1));
        }
      });
    }
    
    // Se n√£o encontrou cor e tamanho, n√£o faz nada
    if (!colorOption || !sizeOption) {
      console.log('‚ö†Ô∏è Produto n√£o tem Cor e Tamanho configurados');
      return;
    }
    
    // Agrupa variantes por cor
    var colorAvailability = {};
    
    variants.forEach(function(variant) {
      var color = variant[colorOption];
      
      if (!colorAvailability[color]) {
        colorAvailability[color] = {
          hasStock: false,
          sizes: [],
          variantIds: []
        };
      }
      
      // Verifica se esta variante tem estoque
      if (variant.available) {
        colorAvailability[color].hasStock = true;
      }
      
      colorAvailability[color].sizes.push({
        size: variant[sizeOption],
        available: variant.available
      });
      
      colorAvailability[color].variantIds.push(variant.id);
    });
    
    console.log('üìä Disponibilidade por cor:', colorAvailability);
    
    // Oculta cores sem estoque
    var hiddenCount = 0;
    Object.keys(colorAvailability).forEach(function(color) {
      if (!colorAvailability[color].hasStock) {
        console.log('üö´ Ocultando cor:', color);
        
        // Encontra o input radio da cor
        var colorInputs = document.querySelectorAll('.color-swatch__radio, .product-form__single-selector');
        
        colorInputs.forEach(function(input) {
          var inputValue = input.value || input.getAttribute('value');
          
          if (inputValue && inputValue.toLowerCase() === color.toLowerCase()) {
            // Oculta o container da cor
            var colorSwatch = input.closest('.color-swatch');
            if (colorSwatch) {
              colorSwatch.style.display = 'none';
              colorSwatch.setAttribute('data-hidden-no-stock', 'true');
              hiddenCount++;
              console.log('‚úÖ Cor "' + color + '" ocultada com sucesso');
            }
          }
        });
      } else {
        console.log('‚úÖ Cor "' + color + '" tem estoque dispon√≠vel');
      }
    });
    
    console.log('üéØ Total de cores ocultadas:', hiddenCount);
  }
  
  // Executa quando a p√°gina carregar
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', hideUnavailableColors);
  } else {
    hideUnavailableColors();
  }
  
  // Re-executa se houver mudan√ßas no produto (para temas din√¢micos)
  setTimeout(hideUnavailableColors, 500);
  setTimeout(hideUnavailableColors, 1000);
  setTimeout(hideUnavailableColors, 2000);
  
})();
</script>

<style>
/* Oculta cores sem estoque */
.color-swatch[data-hidden-no-stock="true"] {
  display: none !important;
}
</style>
