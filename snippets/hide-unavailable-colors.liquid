{%- comment -%}
  Script para ocultar cores e tamanhos sem estoque
  - Oculta CORES que n√£o t√™m nenhum tamanho dispon√≠vel
  - Oculta TAMANHOS que n√£o t√™m nenhuma cor dispon√≠vel
{%- endcomment -%}

<script>
(function() {
  'use strict';
  
  function hideUnavailableOptions() {
    console.log('üé® Iniciando verifica√ß√£o de cores e tamanhos sem estoque...');
    
    // Verifica se o produto tem variantes
    if (!window.theme || !window.theme.product || !window.theme.product.variants) {
      console.log('‚ùå Dados do produto n√£o encontrados');
      return;
    }
    
    var variants = window.theme.product.variants;
    var options = window.theme.product.options;
    
    console.log('üì¶ Produto:', window.theme.product.id);
    console.log('üìã Op√ß√µes:', options);
    console.log('üî¢ Total de variantes:', variants.length);
    
    var colorOption = null;
    var sizeOption = null;
    var colorIndex = -1;
    var sizeIndex = -1;
    
    // Identifica qual op√ß√£o √© cor e qual √© tamanho
    if (options) {
      options.forEach(function(option, index) {
        var optionName = option.toLowerCase();
        console.log('Op√ß√£o ' + (index + 1) + ':', option);
        
        if (optionName.includes('cor') || optionName.includes('color') || optionName.includes('colour')) {
          colorOption = 'option' + (index + 1);
          colorIndex = index;
          console.log('‚úÖ Cor encontrada na op√ß√£o ' + (index + 1));
        }
        if (optionName.includes('tamanho') || optionName.includes('size') || optionName.includes('talla')) {
          sizeOption = 'option' + (index + 1);
          sizeIndex = index;
          console.log('‚úÖ Tamanho encontrado na op√ß√£o ' + (index + 1));
        }
      });
    }
    
    // Se n√£o encontrou cor e tamanho, n√£o faz nada
    if (!colorOption || !sizeOption) {
      console.log('‚ö†Ô∏è Produto n√£o tem Cor e Tamanho configurados');
      return;
    }
    
    // Agrupa variantes por cor
    var colorAvailability = {};
    
    // Agrupa variantes por tamanho
    var sizeAvailability = {};
    
    variants.forEach(function(variant) {
      var color = variant[colorOption];
      var size = variant[sizeOption];
      
      // Processa cores
      if (!colorAvailability[color]) {
        colorAvailability[color] = {
          hasStock: false,
          sizes: []
        };
      }
      
      if (variant.available) {
        colorAvailability[color].hasStock = true;
      }
      
      colorAvailability[color].sizes.push({
        size: size,
        available: variant.available
      });
      
      // Processa tamanhos
      if (!sizeAvailability[size]) {
        sizeAvailability[size] = {
          hasStock: false,
          colors: []
        };
      }
      
      if (variant.available) {
        sizeAvailability[size].hasStock = true;
      }
      
      sizeAvailability[size].colors.push({
        color: color,
        available: variant.available
      });
    });
    
    console.log('üìä Disponibilidade por cor:', colorAvailability);
    console.log('üìè Disponibilidade por tamanho:', sizeAvailability);
    
    // Oculta cores sem estoque
    var hiddenColors = 0;
    Object.keys(colorAvailability).forEach(function(color) {
      if (!colorAvailability[color].hasStock) {
        console.log('üö´ Ocultando cor:', color);
        
        // Encontra o input radio da cor
        var colorInputs = document.querySelectorAll('.color-swatch__radio, .product-form__single-selector');
        
        colorInputs.forEach(function(input) {
          var inputValue = input.value || input.getAttribute('value');
          
          if (inputValue && inputValue.toLowerCase() === color.toLowerCase()) {
            // Oculta o container da cor
            var colorSwatch = input.closest('.color-swatch');
            if (colorSwatch) {
              colorSwatch.style.display = 'none';
              colorSwatch.setAttribute('data-hidden-no-stock', 'true');
              hiddenColors++;
              console.log('‚úÖ Cor "' + color + '" ocultada');
            }
          }
        });
      }
    });
    
    // Oculta tamanhos sem estoque
    var hiddenSizes = 0;
    Object.keys(sizeAvailability).forEach(function(size) {
      if (!sizeAvailability[size].hasStock) {
        console.log('üö´ Ocultando tamanho:', size);
        
        // Encontra todos os inputs/bot√µes de tamanho
        var sizeSelectors = document.querySelectorAll('.size-swatch__radio, .product-form__single-selector, input[type="radio"]');
        
        sizeSelectors.forEach(function(input) {
          var inputValue = input.value || input.getAttribute('value');
          
          if (inputValue && inputValue.toLowerCase() === size.toLowerCase()) {
            // Oculta o container do tamanho
            var sizeContainer = input.closest('.size-swatch') || input.closest('label') || input.parentElement;
            if (sizeContainer) {
              sizeContainer.style.display = 'none';
              sizeContainer.setAttribute('data-hidden-no-stock', 'true');
              hiddenSizes++;
              console.log('‚úÖ Tamanho "' + size + '" ocultado');
            }
          }
        });
      }
    });
    
    console.log('üéØ Total de cores ocultadas:', hiddenColors);
    console.log('üéØ Total de tamanhos ocultados:', hiddenSizes);
  }
  
  // Executa quando a p√°gina carregar
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', hideUnavailableOptions);
  } else {
    hideUnavailableOptions();
  }
  
  // Re-executa se houver mudan√ßas no produto (para temas din√¢micos)
  setTimeout(hideUnavailableOptions, 500);
  setTimeout(hideUnavailableOptions, 1000);
  setTimeout(hideUnavailableOptions, 2000);
  
})();
</script>

<style>
/* Oculta cores e tamanhos sem estoque */
.color-swatch[data-hidden-no-stock="true"],
.size-swatch[data-hidden-no-stock="true"],
label[data-hidden-no-stock="true"] {
  display: none !important;
}
</style>
