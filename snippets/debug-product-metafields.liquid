{%- comment -%}
  DEBUG: Metacampos do Produto
  Adicione temporariamente para ver o que est√° acontecendo
{%- endcomment -%}

<div style="background: #fff3cd; border: 3px solid #ff6b00; padding: 20px; margin: 20px 0; font-family: monospace; font-size: 12px;">
  <h3 style="color: #ff6b00; margin-top: 0;">üîç DEBUG - Metacampos do Produto</h3>
  
  <div style="background: white; padding: 10px; margin: 10px 0; border-left: 4px solid #0066cc;">
    <strong>üì¶ PRODUTO:</strong> {{ product.title }}<br>
    <strong>ID:</strong> {{ product.id }}
  </div>

  <div style="background: white; padding: 10px; margin: 10px 0; border-left: 4px solid #cc6600;">
    <strong>üé® METACAMPO color_mapping:</strong><br>
    
    <div style="margin: 5px 0; padding: 5px; background: #f9f9f9;">
      <strong>product.metafields.custom.color_mapping.value:</strong><br>
      {%- if product.metafields.custom.color_mapping.value != blank -%}
        ‚úÖ <code style="background: #ccffcc; padding: 2px 5px;">{{ product.metafields.custom.color_mapping.value }}</code>
      {%- else -%}
        ‚ùå Vazio
      {%- endif -%}
    </div>
    
    <div style="margin: 5px 0; padding: 5px; background: #f9f9f9;">
      <strong>product.metafields.custom.color_mapping:</strong><br>
      {%- if product.metafields.custom.color_mapping != blank -%}
        ‚úÖ <code style="background: #ccffcc; padding: 2px 5px;">{{ product.metafields.custom.color_mapping }}</code>
      {%- else -%}
        ‚ùå Vazio
      {%- endif -%}
    </div>
  </div>

  <div style="background: white; padding: 10px; margin: 10px 0; border-left: 4px solid #9900cc;">
    <strong>üé® OP√á√ïES DE COR DO PRODUTO:</strong><br>
    {%- for option in product.options_with_values -%}
      {%- assign downcase_option = option.name | downcase -%}
      {%- if downcase_option contains 'cor' or downcase_option contains 'color' -%}
        <strong>Op√ß√£o: {{ option.name }}</strong><br>
        <strong>Valores:</strong><br>
        {%- for value in option.values -%}
          <div style="margin: 5px 0; padding: 5px; background: #f0f0f0;">
            <strong>‚Ä¢ {{ value }}</strong><br>
            
            {%- comment -%}Testar busca no metacampo{%- endcomment -%}
            {%- assign test_color = blank -%}
            {%- if product.metafields.custom.color_mapping.value != blank -%}
              {%- assign mappings = product.metafields.custom.color_mapping.value | split: '|' -%}
              {%- for mapping in mappings -%}
                {%- assign parts = mapping | split: ':' -%}
                {%- assign color_name = parts[0] | strip -%}
                {%- if color_name == value -%}
                  {%- assign test_color = parts[1] | strip -%}
                  {%- break -%}
                {%- endif -%}
              {%- endfor -%}
            {%- elsif product.metafields.custom.color_mapping != blank -%}
              {%- assign mappings = product.metafields.custom.color_mapping | split: '|' -%}
              {%- for mapping in mappings -%}
                {%- assign parts = mapping | split: ':' -%}
                {%- assign color_name = parts[0] | strip -%}
                {%- if color_name == value -%}
                  {%- assign test_color = parts[1] | strip -%}
                  {%- break -%}
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}
            
            {%- if test_color != blank -%}
              ‚úÖ Encontrado: <span style="background: {{ test_color }}; padding: 2px 10px; border: 1px solid #000;">{{ test_color }}</span>
            {%- else -%}
              ‚ùå N√ÉO encontrado no metacampo
            {%- endif -%}
          </div>
        {%- endfor -%}
      {%- endif -%}
    {%- endfor -%}
  </div>

  <div style="background: white; padding: 10px; margin: 10px 0; border-left: 4px solid #cc0000;">
    <strong>üîç TODOS OS METACAMPOS DO PRODUTO:</strong><br>
    <div style="margin: 5px 0; padding: 5px; background: #f9f9f9; font-size: 10px; max-height: 200px; overflow: auto;">
      {{ product.metafields | json }}
    </div>
  </div>

  <div style="background: #ffffcc; padding: 10px; margin: 10px 0; border: 2px solid #cc9900;">
    <strong>üí° DIAGN√ìSTICO:</strong><br>
    {%- if product.metafields.custom.color_mapping.value != blank or product.metafields.custom.color_mapping != blank -%}
      ‚úÖ <strong>Metacampo existe!</strong><br>
      {%- assign has_match = false -%}
      {%- for option in product.options_with_values -%}
        {%- assign downcase_option = option.name | downcase -%}
        {%- if downcase_option contains 'cor' or downcase_option contains 'color' -%}
          {%- for value in option.values -%}
            {%- assign test_color = blank -%}
            {%- if product.metafields.custom.color_mapping.value != blank -%}
              {%- assign mappings = product.metafields.custom.color_mapping.value | split: '|' -%}
              {%- for mapping in mappings -%}
                {%- assign parts = mapping | split: ':' -%}
                {%- assign color_name = parts[0] | strip -%}
                {%- if color_name == value -%}
                  {%- assign has_match = true -%}
                  {%- break -%}
                {%- endif -%}
              {%- endfor -%}
            {%- elsif product.metafields.custom.color_mapping != blank -%}
              {%- assign mappings = product.metafields.custom.color_mapping | split: '|' -%}
              {%- for mapping in mappings -%}
                {%- assign parts = mapping | split: ':' -%}
                {%- assign color_name = parts[0] | strip -%}
                {%- if color_name == value -%}
                  {%- assign has_match = true -%}
                  {%- break -%}
                {%- endif -%}
              {%- endfor -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}
      {%- endfor -%}
      
      {%- if has_match -%}
        ‚úÖ <strong>Nomes correspondem!</strong> Cores devem funcionar.<br>
        <strong>Se n√£o aparecem:</strong> Problema no CSS ou prioridade.
      {%- else -%}
        ‚ùå <strong>PROBLEMA:</strong> Nomes n√£o correspondem!<br>
        <strong>SOLU√á√ÉO:</strong> Nomes no metacampo devem ser EXATAMENTE iguais √†s op√ß√µes.
      {%- endif -%}
    {%- else -%}
      ‚ùå <strong>PROBLEMA:</strong> Metacampo n√£o existe ou est√° vazio!<br>
      <strong>SOLU√á√ÉO:</strong><br>
      1. Criar defini√ß√£o em Configura√ß√µes ‚Üí Metacampos ‚Üí Produtos<br>
      2. Namespace: custom, Key: color_mapping<br>
      3. Adicionar valores no produto
    {%- endif -%}
  </div>

  <div style="background: #ffcccc; padding: 10px; margin: 10px 0;">
    <strong>‚ö†Ô∏è IMPORTANTE:</strong> Remova este snippet ap√≥s o debug!<br>
    Linha para remover: <code>{% raw %}{% render 'debug-product-metafields' %}{% endraw %}</code>
  </div>
</div>
