<script>
(function() {
  var productId = null;
  var button = null;
  
  // Inicializar
  function init() {
    var form = document.querySelector('.product-form');
    if (!form) return;
    
    var dataElement = form.querySelector('[data-product-json]');
    if (!dataElement) return;
    
    try {
      var data = JSON.parse(dataElement.textContent);
      var product = data.product || data;
      productId = product.id;
      button = document.getElementById('notify-trigger-' + productId);
      
      if (!button) return;
      
      // Verificar variante inicial
      if (data.selected_variant_id) {
        var initialVariant = product.variants.find(function(v) {
          return v.id === data.selected_variant_id;
        });
        
        if (initialVariant) {
          updateButton(initialVariant);
        }
      }
      
    } catch (e) {
      console.error('Erro ao inicializar:', e);
    }
  }
  
  // Atualizar bot√£o
  function updateButton(variant) {
    if (!button) return;
    
    var variantIdInput = document.getElementById('bisn-variant-id-' + productId);
    var variantTitleInput = document.getElementById('bisn-variant-title-' + productId);
    var variantDisplay = document.getElementById('bisn-variant-display-' + productId);
    
    if (variant && !variant.available) {
      button.style.display = 'block';
      if (variantIdInput) variantIdInput.value = variant.id;
      if (variantTitleInput) variantTitleInput.value = variant.title || '';
      if (variantDisplay) variantDisplay.textContent = variant.title || '';
    } else {
      button.style.display = 'none';
    }
  }
  
  // Escutar evento do tema
  document.addEventListener('variant:changed', function(event) {
    if (event.detail && event.detail.variant) {
      updateButton(event.detail.variant);
    }
  });
  
  // Inicializar
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
  
  setTimeout(init, 500);
})();
</script>
