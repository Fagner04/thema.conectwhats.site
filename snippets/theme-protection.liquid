{%- comment -%}
  Sistema de Prote√ß√£o do Tema - Vers√£o Melhorada
  S√≥ bloqueia quando detectar tentativa de roubo/c√≥pia
{%- endcomment -%}

<script>
(function() {
  'use strict';
  
  // CONFIGURA√á√ÉO
  var SENHA_CORRETA = 'Fagner2020@';
  var LOJAS_AUTORIZADAS = [
    'emporiobody.myshopify.com',
    'emporiobody.com.br',
    'www.emporiobody.com.br'
  ];
  var TEMA_ATIVADO_KEY = 'tema_conectwhats_ativado';
  
  // Verifica se est√° em loja autorizada
  function isLojaAutorizada() {
    var shopDomain = window.Shopify ? window.Shopify.shop : '';
    var currentDomain = window.location.hostname;
    
    // Verifica se o dom√≠nio atual ou shop est√° na lista de autorizados
    for (var i = 0; i < LOJAS_AUTORIZADAS.length; i++) {
      if (shopDomain === LOJAS_AUTORIZADAS[i] || currentDomain.includes(LOJAS_AUTORIZADAS[i].replace('.myshopify.com', ''))) {
        return true;
      }
    }
    
    return false;
  }
  
  // Verifica se j√° foi ativado nesta loja
  function verificarAtivacao() {
    var ativado = localStorage.getItem(TEMA_ATIVADO_KEY);
    return ativado === 'true';
  }
  
  // Detecta tentativa de c√≥pia/roubo
  function detectarTentativaRoubo() {
    var shopDomain = window.Shopify ? window.Shopify.shop : '';
    
    // Se n√£o est√° na loja autorizada E n√£o est√° ativado = poss√≠vel roubo
    if (!isLojaAutorizada() && !verificarAtivacao()) {
      return true;
    }
    
    return false;
  }
  
  // Solicita senha
  function solicitarSenha() {
    var senha = prompt('üîí TEMA PROTEGIDO\n\nEste tema pertence a ' + LOJA_AUTORIZADA + '\n\nPara usar em outra loja, digite a senha de autoriza√ß√£o:');
    
    if (!senha) {
      bloquearTema('Tema n√£o autorizado para esta loja.');
      return;
    }
    
    if (senha === SENHA_CORRETA) {
      ativarTema();
    } else {
      bloquearTema('Senha incorreta. Entre em contato com o propriet√°rio do tema.');
    }
  }
  
  // Ativa o tema
  function ativarTema() {
    localStorage.setItem(TEMA_ATIVADO_KEY, 'true');
    alert('‚úÖ Tema autorizado para esta loja!');
    location.reload();
  }
  
  // Bloqueia o tema
  function bloquearTema(mensagem) {
    document.body.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif; padding: 20px;"><div style="max-width: 500px; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); text-align: center;"><div style="font-size: 64px; margin-bottom: 20px;">üîí</div><h1 style="color: #333; font-size: 28px; margin-bottom: 15px; font-weight: 600;">Tema Protegido</h1><p style="color: #666; font-size: 16px; line-height: 1.6; margin-bottom: 25px;">' + mensagem + '</p><div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;"><p style="margin: 5px 0; color: #555; font-size: 14px;"><strong>Tema:</strong> ConectWhats Classic</p><p style="margin: 5px 0; color: #555; font-size: 14px;"><strong>Lojas Autorizadas:</strong> emporiobody.com.br</p></div><p style="color: #999; font-size: 13px;">Para autorizar este tema em sua loja, entre em contato com o desenvolvedor.</p></div></div>';
  }
  
  // Adiciona marca d\'√°gua discreta
  function adicionarMarcaDagua() {
    if (!isLojaAutorizada()) {
      var watermark = document.createElement('div');
      watermark.innerHTML = '¬© ConectWhats Theme - N√£o Autorizado';
      watermark.style.cssText = 'position: fixed; bottom: 5px; right: 5px; font-size: 9px; color: rgba(255,0,0,0.4); z-index: 99999; pointer-events: none; background: rgba(255,255,255,0.8); padding: 2px 5px; border-radius: 3px;';
      document.body.appendChild(watermark);
    }
  }
  
  // Inicializa prote√ß√£o
  function iniciar() {
    // Se est√° na loja autorizada, n√£o faz nada
    if (isLojaAutorizada()) {
      console.log('‚úÖ Tema rodando na loja autorizada');
      return;
    }
    
    // Se detectar tentativa de roubo
    if (detectarTentativaRoubo()) {
      console.warn('‚ö†Ô∏è Tema detectado em loja n√£o autorizada');
      
      // Aguarda 3 segundos antes de pedir senha (para n√£o atrapalhar preview r√°pido)
      setTimeout(function() {
        solicitarSenha();
      }, 3000);
      
      adicionarMarcaDagua();
    }
  }
  
  // Aguarda o DOM carregar
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', iniciar);
  } else {
    iniciar();
  }
  
})();
</script>
